getPushshiftData <- function(postType,
title = NULL,
size = NULL,
q = NULL,
after = NULL,
before = NULL,
subreddit = NULL,
nest_level = NULL) {
if(postType == "submission") {
base_url <- "https://api.pushshift.io/reddit/search/submission/"
httr::GET(url = base_url,
query = list(title = title,
size = size,
q = q,
after = after,
before = before,
subreddit = subreddit,
nest_level = nest_level,
sort = "asc")) %>%
.$url %>%
jsonlite::fromJSON() %>%
.$data %>%
jsonlite::flatten(recursive = TRUE) %>%
select(author, title, selftext, created_utc, permalink, num_comments, score, subreddit) %>%
as_tibble() %>%
rename(id = title) %>%
rename(text = selftext) %>%
arrange(created_utc)
}
else {
base_url <- "https://api.pushshift.io/reddit/search/comment/"
httr::GET(url = base_url,
query = list(title = title,
size = size,
q = q,
after = after,
before = before,
subreddit = subreddit,
nest_level = nest_level,
sort = "asc")) %>%
.$url %>%
fromJSON() %>%
.$data %>%
jsonlite::flatten(recursive = TRUE) %>%
select(author, body, permalink, score, created_utc, subreddit) %>%
as_tibble() %>%
rename(id = permalink) %>%
rename(text = body) %>%
arrange(created_utc)
}
}
getPushshiftDataRecursive <- function(postType = "submission",
title = NULL,
size = NULL,
q = NULL,
after = NULL,
before = NULL,
subreddit = NULL,
nest_level = NULL) {
tmp <- getPushshiftData(postType,
title,
size,
q,
after,
before,
subreddit,
nest_level)
out <- tmp %>% filter(FALSE)
#on.exit(return(out), add = TRUE)
after <- last(tmp$created_utc)
while(nrow(tmp) > 0) {
message(
sprintf("%d %ss fetched, last date fetched: %s \n",
nrow(tmp),
postType,
as.Date(as.POSIXct(as.numeric(after)))))
out <- rbind(out, tmp)
after <- last(tmp$created_utc)
tmp <- getPushshiftData(postType,
title,
size,
q,
after,
before,
subreddit,
nest_level)
}
#Sys.sleep(delay)
return(out)
}
getPushshiftDataRecursive(postType = "comment", q = "vegan", subreddit = "Cooking", )
library(dplyr)
library(httr)
library(jsonlite)
getPushshiftDataRecursive(postType = "comment", q = "vegan", subreddit = "Cooking", after = 1579494266) -> samp
getPushshiftDataRecursive <- function(postType = "submission",
title = NULL,
size = NULL,
q = NULL,
after = NULL,
before = NULL,
subreddit = NULL,
nest_level = NULL) {
tmp <- getPushshiftData(postType,
title,
size,
q,
after,
before,
subreddit,
nest_level)
out <- tmp %>% filter(FALSE)
#on.exit(return(out), add = TRUE)
after <- last(tmp$created_utc)
while(nrow(tmp) > 0) {
message(
sprintf("%d %ss fetched, last date fetched: %s \n",
nrow(tmp),
postType,
as.Date(as.POSIXct(as.numeric(after), origin = "1970-01-01"))))
out <- rbind(out, tmp)
after <- last(tmp$created_utc)
tmp <- getPushshiftData(postType,
title,
size,
q,
after,
before,
subreddit,
nest_level)
}
#Sys.sleep(delay)
return(out)
}
getPushshiftDataRecursive(postType = "comment", q = "vegan", subreddit = "Cooking", after = 1579494266) -> samp
View(samp)
getPushshiftDataRecursive(postType = "comment", q = "vegan", subreddit = "Cooking", after = 1579494266) -> samp
getPushshiftDataRecursive <- function(postType = "submission",
title = NULL,
size = NULL,
q = NULL,
after = NULL,
before = NULL,
subreddit = NULL,
nest_level = NULL) {
tmp <- getPushshiftData(postType,
title,
size,
q,
after,
before,
subreddit,
nest_level)
out <- tmp %>% filter(FALSE)
on.exit(return(out), add = TRUE)
after <- last(tmp$created_utc)
while(nrow(tmp) > 0) {
message(
sprintf("%d %ss fetched, last date fetched: %s \n",
nrow(tmp),
postType,
as.Date(as.POSIXct(as.numeric(after), origin = "1970-01-01"))))
out <- rbind(out, tmp)
after <- last(tmp$created_utc)
tmp <- getPushshiftData(postType,
title,
size,
q,
after,
before,
subreddit,
nest_level)
}
#Sys.sleep(delay)
#return(out)
}
getPushshiftDataRecursive(postType = "comment", q = "vegan", subreddit = "Cooking", after = 1579494266) -> samp
getPushshiftDataRecursive <- function(postType = "submission",
title = NULL,
size = NULL,
q = NULL,
after = NULL,
before = NULL,
subreddit = NULL,
nest_level = NULL,
delay = 0) {
tmp <- getPushshiftData(postType,
title,
size,
q,
after,
before,
subreddit,
nest_level)
out <- tmp %>% filter(FALSE)
after <- last(tmp$created_utc)
while(nrow(tmp) > 0) {
message(
sprintf("%d %ss fetched, last date fetched: %s \n",
nrow(tmp),
postType,
as.Date(as.POSIXct(as.numeric(after), origin = "1970-01-01"))))
out <- rbind(out, tmp)
after <- last(tmp$created_utc)
tmp <- getPushshiftData(postType,
title,
size,
q,
after,
before,
subreddit,
nest_level)
}
Sys.sleep(delay)
on.exit(return(out), add = TRUE)
}
getPushshiftDataRecursive(postType = "comment", q = "vegan", subreddit = "Cooking", after = 1579494266) -> samp
getPushshiftDataRecursive <- function(postType = "submission",
title = NULL,
size = NULL,
q = NULL,
after = NULL,
before = NULL,
subreddit = NULL,
nest_level = NULL) {
tmp <- getPushshiftData(postType,
title,
size,
q,
after,
before,
subreddit,
nest_level)
out <- tmp %>% filter(FALSE)
after <- last(tmp$created_utc)
while(nrow(tmp) > 0) {
message(
sprintf("%d %ss fetched, last date fetched: %s \n",
nrow(tmp),
postType,
as.Date(as.POSIXct(as.numeric(after), origin = "1970-01-01"))))
out <- rbind(out, tmp)
after <- last(tmp$created_utc)
tmp <- getPushshiftData(postType,
title,
size,
q,
after,
before,
subreddit,
nest_level)
}
on.exit(return(out), add = TRUE)
}
getPushshiftDataRecursive(postType = "comment", q = "vegan", subreddit = "Cooking", after = 1579494266) -> samp
